\newpage \chapter{Instalação}\setcounter{SteP}{1}

    Este capítulo contém os procedimentos para instalação e configuração
essencial dos pacotes de software necessários para a execução do Drupal.

\section{Apache e PHP}\setcounter{SteP}{1}

\begin{BoxVerbatim}
# apt-get install apache2 libapache2-mod-php7.0
# mkdir /var/www/novoportal
\end{BoxVerbatim}

\begin{itemize}
\item{\bf }VirtualHost: /etc/apache2/sites-available/novoportal.conf
\end{itemize}

\begin{VerbatimNumerado}
<IfModule mod_ssl.c>
    <VirtualHost *:80>
        ServerName novoportal.trt8.net
        Redirect / https://novoportal.exmaple.com/
    </VirtualHost>
    <VirtualHost *:443>
        ServerAdmin reinaldoc@gmail.com
        ServerName novoportal.example.com
        DocumentRoot /var/www/novoportal
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        # SSL Engine
        SSLEngine on
        SSLCertificateFile    /etc/ssl/private/novoportal.cer
        SSLCertificateKeyFile /etc/ssl/private/novoportal.key

        <FilesMatch "\.php$">
            SSLOptions +StdEnvVars
        </FilesMatch>
    </VirtualHost>
</IfModule>
\end{VerbatimNumerado}

\begin{BoxVerbatim}
# a2enmod ssl
# a2ensite novoportal
\end{BoxVerbatim}

\begin{itemize}
\item{\bf }Configurações gerais
\end{itemize}

\begin{BoxVerbatim}
# /etc/apache2/conf-available/security.conf
# l.25
ServerTokens Prod
\end{BoxVerbatim}

\begin{BoxVerbatim}
# /etc/php/7.0/apache2/php.ini
# l.656
post_max_size = 20M
# l.809
upload_max_filesize = 12M
\end{BoxVerbatim}

\begin{BoxVerbatim}
# /etc/init.d/apache2 restart
\end{BoxVerbatim}

\section{MySQL}\setcounter{SteP}{1}

\begin{BoxVerbatim}
# apt-get install mariadb-server-10.1
\end{BoxVerbatim}

\begin{itemize}
\item{\bf }Preparar banco de dados
\end{itemize}

\begin{BoxVerbatim}
# mysql -p
> CREATE DATABASE novoportal CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
> CREATE USER 'novoportal'@'localhost' IDENTIFIED BY 'top-secret';
> GRANT SELECT, INSERT, UPDATE, DELETE, ALTER, CREATE, DROP, INDEX, LOCK TABLES, REFERENCES ON novoportal.* TO 'novoportal'@'localhost';
> FLUSH PRIVILEGES;
> QUIT;
\end{BoxVerbatim}

\section{FTP Server}\setcounter{SteP}{1}

\begin{BoxVerbatim}
@ instalar servidor VS FTP
# apt-get install vsftpd

@ permitir que usuários com shell /bin/false realizem login no FTP.
# echo '/bin/false' >> /etc/shells
\end{BoxVerbatim}

\begin{itemize}
\item{\bf }Configurações: /etc/vsftpd.conf
\end{itemize}

\begin{BoxVerbatim}
# l.31
write_enable=YES
# l.103
ftpd_banner=FTP Server ready.
# l.114
chroot_local_user=YES
allow_writeable_chroot=YES
# l.155
utf8_filesystem=YES
\end{BoxVerbatim}

\section{Drupal}\setcounter{SteP}{1}

\begin{itemize}
\item{\bf }https://ftp.drupal.org/files/projects/drupal-7.56.tar.gz
\item{\bf }https://ftp.drupal.org/files/translations/7.x/drupal/drupal-7.56.pt-br.po
\end{itemize}

\begin{BoxVerbatim}
adduser --home /var/www/novoportal --no-create-home --shell /bin/false novoportal
mkdir /var/www/novoportal
chown novoportal: /var/www/novoportal
su - novoportal -s /bin/bash
tar --strip-components=1 -xzf /path/to/drupal-7.xx.tar.gz
mv /path/to/drupal-7.56.pt-br.po profiles/standard/translations
\end{BoxVerbatim}

    Inicie o navegador para acesso ao Drupal.
